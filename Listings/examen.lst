C51 COMPILER V9.60.0.0   EXAMEN                                                            05/15/2023 00:03:02 PAGE 1   


C51 COMPILER V9.60.0.0, COMPILATION OF MODULE EXAMEN
OBJECT MODULE PLACED IN .\Objects\examen.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE examen.c OPTIMIZE(8,SPEED) BROWSE NOAREGS DEBUG OBJECTEXTEND PRINT(.\Lis
                    -tings\examen.lst) TABS(2) OBJECT(.\Objects\examen.obj)

line level    source

   1          #include <reg552.h>
   2          
   3          #define BASE_DE_TIEMPO_MODO_1 50000
   4          #define BASE_DE_TIEMPO_MODO_2 250
   5          #define FREQ_OCS              11.0592
   6          
   7          
   8          // Declaracion de funciones
   9          void inicializar(void);
  10          
  11          // Salidas P4
  12          // Cohetes
  13          sbit cohete1 = 0xC0;
  14          sbit cohete2 = 0xC1;
  15          sbit cohete3 = 0xC2;
  16          // Seguridad
  17          sbit guillotina = 0xC7;
  18          
  19          // Entradas P1
  20          sbit disparo    = 0x90;
  21          sbit seleccionModo = 0x91;
  22          sbit EMERGENCIA = 0x97;
  23          
  24          // Variables globales
  25          unsigned long int contador;
  26          unsigned char TL_0, TH_0;
  27          unsigned char DISPARADO;
  28          //unsigned char MODO; // MODO = 0 (MODO 1 16 bits) ; MODO = 1 (MODO 2 8 bit con autorecarga)
  29          unsigned long int desbordamientos;
  30          
  31          void main(void)
  32          {
  33   1      
  34   1          // Inicializa
  35   1          inicializar();
  36   1      
  37   1          while (1) {
  38   2      
  39   2              while ((disparo == 0) && (DISPARADO == 0) && (EMERGENCIA == 0)) {
  40   3                  // Todas las salidas a cero listas
  41   3                  cohete1    = 0;
  42   3                  cohete2    = 0;
  43   3                  cohete3    = 0;
  44   3                  guillotina = 0;
  45   3                  // contador para el ciclo lo mantenemos en cero
  46   3                  contador = 0;
  47   3              }
  48   2              if (disparo && !EMERGENCIA) {
  49   3                  DISPARADO = 1;
  50   3              }
  51   2          }
  52   1      }
  53          
  54          /*################# FUNCIONES ######################*/
C51 COMPILER V9.60.0.0   EXAMEN                                                            05/15/2023 00:03:02 PAGE 2   

  55          
  56          // CONFIGURACION//
  57          
  58          void inicializar(void)
  59          {
  60   1      
  61   1          // Variables locales
  62   1          unsigned char valor_carga_inical;
  63   1      
  64   1          // Seleccion de modo por defecto MODO1
  65   1          //MODO = seleccionModo;
  66   1      
  67   1      
  68   1          /*
  69   1          ################ MODO 1 ###############33
  70   1          if (MODO == 0) {
  71   1              // Configuracion timer 0  modo 2 (10) 16bits
  72   1              TMOD = TMOD | 0x01;
  73   1      
  74   1              // Calculo y carga del temporizador
  75   1              valor_carga_inical = (0xFFFF - 1) - BASE_DE_TIEMPO_MODO_1 * FREQ_OCS / 12.0;
  76   1              TL_0               = valor_carga_inical;
  77   1              TH_0               = valor_carga_inical >> 8;
  78   1              TL0                = TL_0;
  79   1              TH0                = TH_0;
  80   1      
  81   1              // Se fijan unos los desbordamientos por segundo
  82   1              DESB_x_SEG = 20;
  83   1          }
  84   1      
  85   1          */
  86   1          /*################ MODO 2 ###############33*/
  87   1          //if (MODO == 1) {
  88   1              // Configuracion timer 0  modo 2 (10) 8bits con autorecarga
  89   1              TMOD = TMOD | 0x02;
  90   1      
  91   1              // Calculo y carga del temporizador
  92   1              valor_carga_inical = (0xFF - 1) - BASE_DE_TIEMPO_MODO_2 * FREQ_OCS / 12.0;
  93   1              TL_0               = valor_carga_inical;
  94   1              TH_0               = valor_carga_inical;
  95   1              TL0                = TL_0;
  96   1              TH0                = TH_0;
  97   1      
  98   1              // Se fijan unos los desbordamientos por segundo
  99   1              desbordamientos = 4000;
 100   1         // }
 101   1          // Interruciones
 102   1          EA  = 1; // Interrpciones globales
 103   1          ET0 = 1; // Interrupcion timer0
 104   1      
 105   1          // Salidas a cero por seguridad
 106   1          cohete1    = 0;
 107   1          cohete2    = 0;
 108   1          cohete3    = 0;
 109   1          guillotina = 0;
 110   1      
 111   1      
 112   1          // TR0 START
 113   1          TR0 = 1;
 114   1      }
 115          ////////////////////////////////////////////////////////////////////////////////
 116          
C51 COMPILER V9.60.0.0   EXAMEN                                                            05/15/2023 00:03:02 PAGE 3   

 117          // INTERRUPCION TR0//
 118          
 119          void interrupcionTR0(void) interrupt 1 using 3
 120          {
 121   1      
 122   1          // Variables locales
 123   1      
 124   1          // Si estamos en MODO 1 recargamos el TR0
 125   1          //if (MODO == 0) {
 126   1          //    TL0 = TL_0;
 127   1          //    TH0 = TH_0;
 128   1         // }
 129   1      
 130   1          // Sumamos un desbrodamiento SI ESTAMOS EN MARCHA
 131   1          if (DISPARADO == 1) {
 132   2              contador++;
 133   2          }
 134   1      
 135   1          if ((contador > 0) && (contador < (5 * desbordamientos)) && (EMERGENCIA == 0)) {
 136   2              // Disparamos el primer choete
 137   2              cohete1   = 1;
 138   2              DISPARADO = 1;
 139   2          }
 140   1      
 141   1          if (contador == (5 * desbordamientos) && (EMERGENCIA == 0)) {
 142   2              cohete2   = 1;
 143   2              DISPARADO = 1;
 144   2          }
 145   1      
 146   1          if (contador == (8 * desbordamientos) && (EMERGENCIA == 0)) {
 147   2              cohete3   = 1;
 148   2              DISPARADO = 1;
 149   2          }
 150   1      
 151   1          if (contador == (48000) && (EMERGENCIA == 0)) {
 152   2              cohete1   = 0;
 153   2              cohete2   = 0;
 154   2              cohete3   = 0;
 155   2              DISPARADO = 0;
 156   2              contador  = 0;
 157   2          }
 158   1      
 159   1          if (EMERGENCIA == 1) {
 160   2      
 161   2              // Corte de mechas
 162   2              guillotina = 1;
 163   2      
 164   2              // Desactivacion pines de disparo
 165   2              cohete1 = 0;
 166   2              cohete2 = 0;
 167   2              cohete3 = 0;
 168   2      
 169   2              while (EMERGENCIA == 1) {
 170   3                  // mientras se espera el reset de emergencia se inicializan los parameetros necesarios para vo
             -lver al modo espera
 171   3                  DISPARADO  = 0;
 172   3                  contador   = 0;
 173   3                  guillotina = 0;
 174   3              }
 175   2          }
 176   1      }

C51 COMPILER V9.60.0.0   EXAMEN                                                            05/15/2023 00:03:02 PAGE 4   


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    343    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     11    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
